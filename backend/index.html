<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>BookRec API Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        section {
            margin-bottom: 30px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input,
        select,
        textarea {
            margin: 5px 0;
            padding: 5px;
            width: 100%;
        }
        button {
            margin-top: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>BookRec API Tester</h1>

    <!-- ------------------- Register ------------------- -->
    <section>
        <h2>Register</h2>
        <input type="text" id="reg_name" placeholder="Name" />
        <input type="email" id="reg_email" placeholder="Email" />
        <input type="password" id="reg_password" placeholder="Password" />
        <label style="display: flex; align-items: center; width: max-content; gap: 5px;">
            <input type="checkbox" id="reg_admin" />
            <p style="white-space: nowrap;">Is Admin</p>

        </label>
        <label style="display: flex; align-items: center; width: max-content; gap: 5px;">
            <input type="checkbox" id="reg_verified" />
            <p style="white-space: nowrap;">Is Verified</p>

        </label>
        <button type="button" onclick="registerUser()">Register</button>
        <pre id="reg_result"></pre>
    </section>

    <!-- ------------------- Login ------------------- -->
    <section>
        <h2>Login</h2>
        <input type="email" id="login_email" placeholder="Email" />
        <input type="password" id="login_password" placeholder="Password" />
        <button type="button" onclick="loginUser()">Login</button>
        <pre id="login_result"></pre>
    </section>


    <!-- ------------------- Lists ------------------- -->
    <section>
        <h2>Book Lists</h2>
        <input type="text" id="list_user_id" placeholder="User ID (UUID)" />
        <input type="text" id="list_name" placeholder="List Name" />
        <input type="text" id="book_id" placeholder="Book ID (Google Books)" />

        <button type="button" onclick="createList()">Create List</button>
        <button type="button" onclick="addBook()">Add Book</button>
        <button type="button" onclick="removeBook()">Remove Book</button>
        <button type="button" onclick="deleteList()">Delete List</button>
        <button type="button" onclick="getLists()">Get All Lists</button>
        <button type="button" onclick="getBooks()">Get Books in List</button>

        <pre id="list_result"></pre>
    </section>

    <!-- ------------------- Recommendations ------------------- -->
    <section>
        <h2>Recommendations</h2>
        <input type="text" id="rec_user_id" placeholder="User ID (UUID)" />
        <textarea
            id="rec_data"
            placeholder='JSON e.g. {"liked_books":["id1"],"favourite_genres":["Fantasy"],"rec_count":5}'
        ></textarea>
        <button type="button" onclick="getRecommendations()">Get Recommendations</button>
        <button type="button" onclick="prefillRecommendations()">Prefill Dummy Recommendations</button>
        <pre id="rec_result"></pre>
    </section>

    <script>
        const BASE_URL = "http://127.0.0.1:5000";

        // ------------------- Register -------------------
        function registerUser() {
            const name = document.getElementById("reg_name").value;
            const email = document.getElementById("reg_email").value;
            const password = document.getElementById("reg_password").value;
            const admin = document.getElementById("reg_admin").checked;
            const verified = document.getElementById("reg_verified").checked;

            fetch(`${BASE_URL}/register`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, password, admin, verified }),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("reg_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        // ------------------- Login -------------------
        function loginUser() {
            const email = document.getElementById("login_email").value;
            const password = document.getElementById("login_password").value;

            fetch(`${BASE_URL}/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("login_result").textContent = JSON.stringify(data, null, 2);
            });
        }


        // ------------------- Lists -------------------
        function createList() {
            const user_id = document.getElementById("list_user_id").value;
            const list_name = document.getElementById("list_name").value;

            fetch(`${BASE_URL}/lists`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_id, list_name }),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("list_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        function addBook() {
            const user_id = document.getElementById("list_user_id").value;
            const list_name = document.getElementById("list_name").value;
            const book_id = document.getElementById("book_id").value;

            fetch(`${BASE_URL}/lists/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_id, list_name, book_id }),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("list_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        function removeBook() {
            const user_id = document.getElementById("list_user_id").value;
            const list_name = document.getElementById("list_name").value;
            const book_id = document.getElementById("book_id").value;

            fetch(`${BASE_URL}/lists/remove`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_id, list_name, book_id }),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("list_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        function deleteList() {
            const user_id = document.getElementById("list_user_id").value;
            const list_name = document.getElementById("list_name").value;

            fetch(`${BASE_URL}/lists/delete`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_id, list_name }),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("list_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        function getLists() {
            const user_id = document.getElementById("list_user_id").value;
            fetch(`${BASE_URL}/lists?user_id=${user_id}`)
            .then(r => r.json())
            .then(data => {
                document.getElementById("list_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        function getBooks() {
            const user_id = document.getElementById("list_user_id").value;
            const list_name = document.getElementById("list_name").value;
            fetch(`${BASE_URL}/lists/books?user_id=${user_id}&list_name=${list_name}`)
            .then(r => r.json())
            .then(data => {
                document.getElementById("list_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        // ------------------- Recommendations -------------------
        function getRecommendations() {
            const user_id = document.getElementById("rec_user_id").value;

            let recData;
            try {
                recData = JSON.parse(document.getElementById("rec_data").value);
            } catch (e) {
                alert("Invalid JSON");
                return;
            }

            recData.user_id = user_id;

            fetch(`${BASE_URL}/recommend`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(recData),
            })
            .then(r => r.json())
            .then(data => {
                document.getElementById("rec_result").textContent = JSON.stringify(data, null, 2);
            });
        }

        function prefillRecommendations() {
            const dummy = {
                liked_books: ["bookId1", "bookId2"],
                favourite_genres: ["Fantasy", "Sci-Fi"],
                rec_count: 5,
            };
            document.getElementById("rec_data").value = JSON.stringify(dummy, null, 2);
        }
    </script>
</body>
</html>
